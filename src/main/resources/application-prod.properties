# ========================================
# ? PRODUCTION CONFIGURATION OPTIMIZED FOR RENDER
# ========================================
spring.application.name=control-financiero

# ========================================
# ? LAZY INITIALIZATION (Reduce startup time)
# ========================================
spring.main.lazy-initialization=true
spring.data.jpa.repositories.bootstrap-mode=deferred
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false

# ========================================
# ? DATABASE CONFIGURATION (Neon PostgreSQL)
# ========================================
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/control_financiero}
spring.datasource.driver-class-name=org.postgresql.Driver

# ========================================
# ? CONNECTION POOL OPTIMIZED (Fast startup)
# ========================================
# MINIMUM connections on startup (1 instead of 2)
spring.datasource.hikari.minimum-idle=1
# MAXIMUM connections (reduce to 3 for free tier)
spring.datasource.hikari.maximum-pool-size=3
# FAST connection timeout (10s instead of 30s)
spring.datasource.hikari.connection-timeout=10000
# Keep connections alive for 10 minutes
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
# Connection test query (validate fast)
spring.datasource.hikari.connection-test-query=SELECT 1
# Avoid connection validation on startup
spring.datasource.hikari.initialization-fail-timeout=-1

# ========================================
# ? JPA HIBERNATE OPTIMIZED
# ========================================
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
# Update schema automatically (only for production deployments)
spring.jpa.hibernate.ddl-auto=update
# Disable SQL logging in production
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
# Batch operations for performance
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
# Lazy loading optimization
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true
# Disable Hibernate second-level cache (not needed for Free Tier)
spring.jpa.properties.hibernate.cache.use_query_cache=false
spring.jpa.properties.hibernate.cache.use_second_level_cache=false

# ========================================
# ? LOGGING (Minimal in production)
# ========================================
logging.level.root=WARN
logging.level.com.controfinanciero=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=ERROR
logging.pattern.console=%d{HH:mm:ss} %-5level %logger{36} - %msg%n

# ========================================
# ? SERVER CONFIGURATION
# ========================================
server.port=${PORT:8080}
# Enable compression to reduce response size
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024
# Tomcat optimization
server.tomcat.threads.max=50
server.tomcat.threads.min-spare=5
server.tomcat.accept-count=10
server.tomcat.max-connections=200
# Fast shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# ========================================
# ? ACTUATOR FOR HEALTH CHECKS (Optimized)
# ========================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
# Liveness & Readiness probes
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
# DISABLE database health check on startup (faster)
management.health.db.enabled=false
# Custom health check interval
management.endpoint.health.probes.enabled=true

# ========================================
# ? SECURITY HEADERS
# ========================================
server.error.include-message=always
server.error.include-binding-errors=always

